<!DOCTYPE html>
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <title>
      lukaszkups.net - Sending emails with Meteor.js
    </title>
    <meta content='lukaszkups.net - front-end development, branding, design' name='description'>
    <link href='/stylesheet/stylesheet.css' media='screen' rel='stylesheet' type='text/css'>
    <script src='http://code.jquery.com/jquery-latest.min.js' type='text/javascript'></script>
    <script src='/javascripts/bracketslider.js' type='text/javascript'></script>
    <meta content='nanoc 3.1.6' name='generator'>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport'>
    <link href='/images/favicon.png' rel='shortcut icon' type='image/png'>
    <link href='http://lukaszkups.net/images/favicon.png' rel='shortcut icon' type='image/png'>
    <link href='http://fonts.googleapis.com/css?family=Lato|Droid+Sans|Roboto+Slab:300|Open+Sans' rel='stylesheet' type='text/css'>
    <meta content='http://lukaszkups.net/images/logo.jpg' property='og:image'>
    <link href='/stylesheet/highlightjs_styles.css' rel='stylesheet'>
    <script src='/javascripts/highlight.js'></script>
  </head>
  <body>
    <div class='main-container header'>
      <a class='site-title' href='/'>
        <div class='logo'></div>
        <span class='droid'>
          Front-end engineering.
        </span>
      </a>
      <ul class='main-menu'>
        <li>
          <a href='/experience/'>
            Experience
          </a>
        </li>
        <li>
          <a href='/notes/'>
            Notes
          </a>
        </li>
        <li>
          <a href='/about/'>
            About
          </a>
        </li>
        <li>
          <a href='/contact/'>
            Contact
          </a>
        </li>
      </ul>
    </div>
    <div class='clear clear40'></div>
    <div class='main-container project-container'>
      
      <h1 id="sending-emails-with-meteorjs">Sending emails with Meteor.js</h1>
      
      <h2 id="this-is-a-personal-wrap-up-explanation-of-the-code-available-in-official-meteorjs-documentationhttpdocsmeteorcom">This is a personal wrap-up explanation of the code available in <a href="http://docs.meteor.com">official Meteor.js documentation</a></h2>
      
      <p>Today I had to implement contact form for one of my Meteor.js project. At first I’ve jumped to official Meteor.js documentation and analyse email mechanics.</p>
      
      <p>At the beginning, we have to install <code>email</code> package (via terminal):</p>
      
      <pre>&#x000A;<code class="bash">&#x000A;meteor add email&#x000A;</code></pre>
      
      <p>Next, we need to declare our email settings - to do that, let’s create a <code>server/smtp.js</code> file:</p>
      
      <pre>&#x000A;<code class="javascript">&#x000A;Meteor.startup(function(){&#x000A;	process.env.MAIL_URL = 'smtp://email_username:email_password@email_host:email_port/'&#x000A;});&#x000A;</code></pre>
      
      <p>Example for gmail:</p>
      
      <pre>&#x000A;<code class="javascript">&#x000A;Meteor.startup(function(){&#x000A;	process.env.MAIL_URL = 'smtp://boo.foo:superDooperPassword@smtp.gmail.com:587/'&#x000A;});&#x000A;</code></pre>
      
      <p>We can also use custom domain email account:</p>
      
      <pre>&#x000A;<code class="javascript">&#x000A;Meteor.startup(function(){&#x000A;	process.env.MAIL_URL = 'smtp://boo.foo@awesomedomain.com:superDooperPassword@smtp.gmail.com:587/'&#x000A;});&#x000A;</code></pre>
      
      <p>After everything is set, let’s register actual sending method, available for client (but declared on server so place code below somewhere under <code>server/</code> folder):</p>
      
      <pre>&#x000A;<code class="javascript">&#x000A;// In your server code: define a method that the client can call&#x000A;Meteor.methods({&#x000A;  sendEmail: function (to, from, subject, text) {&#x000A;    check([to, from, subject, text], [String]);&#x000A;&#x000A;    // Let other method calls from the same client start running,&#x000A;    // without waiting for the email sending to complete.&#x000A;    this.unblock();&#x000A;&#x000A;    //actual email sending method&#x000A;    Email.send({&#x000A;      to: to,&#x000A;      from: from,&#x000A;      subject: subject,&#x000A;      text: text&#x000A;    });&#x000A;  }&#x000A;});&#x000A;</code></pre>
      
      <p>Those function arguments are of course optional - we can also add <code>cc</code>, <code>bcc</code>, <code>Reply-To</code>, <code>html</code> or <code>headers</code>.</p>
      
      <p>My example for contact form:</p>
      
      <pre>&#x000A;<code class="javascript">&#x000A;Meteor.methods({&#x000A;  sendEmail: function (text) {&#x000A;    check([text], [String]);&#x000A;&#x000A;    this.unblock();&#x000A;&#x000A;    Email.send({&#x000A;      to: 'support@myClientProject.com',&#x000A;      from: 'contact@myClientProject.com',&#x000A;      subject: 'New message from contact form',&#x000A;      text: text&#x000A;    });&#x000A;  }&#x000A;});&#x000A;</code></pre>
      
      <p>After we declared our server method, let’s create actual sending event:</p>
      
      <pre>&#x000A;<code class="javascript">&#x000A;Template.contactFormTemplate.events({&#x000A;	'submit form#contactForm':function(e){&#x000A;		var contactForm = $(e.currentTarget),&#x000A;			fname = contactForm.find('#firstName').val(),&#x000A;			lname = contactForm.find('#lastName').val(),&#x000A;			email = contactForm.find('#email').val(),&#x000A;			phone = contactForm.find('#phone').val(),&#x000A;			message = contactForm.find("#message").val();&#x000A;&#x000A;		//isFilled and isEmail are my helper methods, which checks if variable exists or is email address valid&#x000A;		if(isFilled(fname) &amp;&amp; isFilled(lname) &amp;&amp; isFilled(email) &amp;&amp; isFilled(phone) &amp;&amp; isFilled(message) &amp;&amp; isEmail(email)){&#x000A;			var dataText = "Message from: " + fname + " " + lname + "\rEmail: " + email + "\rPhone: " + phone + "\rContent:" + message;&#x000A;&#x000A;			Meteor.call('sendEmail', dataText);&#x000A;			//throwAlert is my helper method which creates popup with message&#x000A;			throwAlert('Email send.', 'success');&#x000A;		}else{&#x000A;			throwAlert('An error occurred. Sorry', 'error');&#x000A;			return false;&#x000A;		}&#x000A;	}&#x000A;});&#x000A;</code></pre>
      
      <p>Besides of code above, You need of course some html template code:</p>
      
      <pre>&#x000A;<code class="html">&#x000A;&lt;template name="contactFormTemplate"&gt;&#x000A;	&lt;form id="contactForm"&gt;&#x000A;		&lt;input type ="text" name="firstName" id="firstName" placeholder="First name"/&gt;&#x000A;		&lt;type="text" name="lastName" id="lastName" placeholder="last name"/&gt;&#x000A;		&lt;input type="text" name="phone" id="phone" placeholder="Phone number"/&gt;&#x000A;		&lt;input type="email" name="email" id="email" placeholder="Your email address"/&gt;&#x000A;		&lt;textarea id="message"&gt;&lt; /textarea&gt;&#x000A;		&lt;input type="submit" value="Send"/&gt;&#x000A;	&lt;/form&gt;&#x000A;&lt;/template&gt;&#x000A;</code></pre>
      
      <p>And that’s all - it was THAT easy. You can now add <code>{{&gt; contactFormTemplate}}</code> tag to any template You want and enjoy Your awesome contact form.</p>
      
      <p>– ł.</p>
    </div>
    <div class='clear clear40'></div>
    <div class='main-container'>
      <div class='footer lato'>
        Copyright &copy; 2009 -
        2015
        Lukasz Kups (
        <a href='http://twitter.com/lukaszkups'>
          @lukaszkups
        </a>
        )
      </div>
    </div>
    <div class='clear clear20'></div>
    <script src='/javascripts/application.js' type='text/javascript'></script>
    <script src='/javascripts/blog.js' type='text/javascript'></script>
  </body>
</html>
